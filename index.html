<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Pago - Informaci√≥n de Transferencia</title>
  <style>
    body {
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      padding: 20px;
      background: #f7f7f8;
      color: #111;
    }
    .card {
      background: white;
      border-radius: 12px;
      padding: 18px;
      box-shadow: 0 6px 20px rgba(0,0,0,0.06);
      max-width: 520px;
      margin: 24px auto;
    }
    h1 { font-size: 20px; margin: 0 0 8px; }
    p.lead { margin: 0 0 14px; color: #444; }
    .field { margin-bottom:12px; }
    .label { font-size:12px; color:#666; margin-bottom:6px; display:block; }
    .value {
      font-size:16px;
      padding:10px;
      background:#f3f4f6;
      border-radius:8px;
      display:flex;
      justify-content:space-between;
      align-items:center;
    }
    button {
      margin-left:8px;
      padding:8px 10px;
      border-radius:8px;
      border:0;
      background:#0b5fff;
      color:white;
      cursor:pointer;
    }
    .whatsapp {
      display: inline-block;
      width: 220px;
      text-align: center;
      margin-top: 12px;
      text-decoration: none;
      padding: 10px 14px;
      border-radius: 10px;
      background: #25D366;
      color: white;
      font-weight: 600;
      box-sizing: border-box;
    }
    footer { text-align:center; margin-top:18px; color:#999; font-size:13px; }
    .a { text-align: center; }

    /* contador */
    #contador {
      position: fixed;
      bottom: 8px;
      right: 10px;
      background: rgba(0,0,0,0.7);
      color: #fff;
      font-size: 13px;
      padding: 6px 10px;
      border-radius: 8px;
      font-family: monospace;
      z-index: 9999;
    }
  </style>
</head>
<body>
  <div class="card">
    <h1>Informaci√≥n para Transferencia</h1>
    <p class="lead">Copia los datos para hacer la transferencia en tu banco o app.</p>

    <div class="field">
      <span class="label">N√∫mero de cuenta</span>
      <div class="value">
        <span id="cuenta">4152314371749121</span>
        <div>
          <button onclick="copyText('cuenta', this)">Copiar</button>
        </div>
      </div>
    </div>

    <div class="field">
      <span class="label">Nombre del beneficiario</span>
      <div class="value">
        <span id="beneficiario">JOSE ALFREDO RAMIREZ ACOSTA</span>
        <div>
          <button onclick="copyText('beneficiario', this)">Copiar</button>
        </div>
      </div>
    </div>

    <div class="field">
      <span class="label">Concepto sugerido</span>
      <div class="value">
        <span id="concepto">SIX SAN PEDRO</span>
        <div>
          <button onclick="copyText('concepto', this)">Copiar</button>
        </div>
      </div>
    </div>
    
    <div class="a">
      <a class="whatsapp" href="https://wa.me/5216624446775?text=Hola%20quiero%20hacer%20una%20compra%20en%20Six%20San%20Pedro" target="_blank">WhatsApp Manuel</a><br>
      <a class="whatsapp" href="https://wa.me/5216621559978?text=Hola%20quiero%20hacer%20una%20compra%20en%20Six%20San%20Pedro" target="_blank">WhatsApp Joel</a>
    </div>
  </div>

  <div id="contador">Cargando visitas...</div>

<script>
/* copia al portapapeles - ahora recibe el bot√≥n para cambiar el texto temporalmente */
function copyText(id, btn){
  const el = document.getElementById(id);
  if(!el) return;
  const text = el.innerText;
  navigator.clipboard.writeText(text).then(function(){
    const old = btn.innerText;
    btn.innerText = 'Copiado';
    setTimeout(()=> btn.innerText = old,1200);
  }, function(){
    alert('No se pudo copiar. Selecciona y copia manualmente: ' + text);
  });
}

/* redirecci√≥n despu√©s de 10s */
setTimeout(() => {
  window.location.href = "https://google.com";
}, 10000);

/* Contador global con l√≠mite por IP: 1 conteo cada 12 horas */
async function contarVisitaConIP() {
  const contadorID = "six_san_pedro_pagos"; // namespace que quieras
  const limiteMs = 12 * 60 * 60 * 1000; // 12 horas

  try {
    // 1) obtener IP p√∫blica del visitante
    const ipResp = await fetch("https://api.ipify.org?format=json");
    if (!ipResp.ok) throw new Error("No se pudo obtener IP");
    const ipJson = await ipResp.json();
    const ip = ipJson.ip;

    // 2) clave local para este ip
    const key = `visita_${ip}`;
    const lastTsStr = localStorage.getItem(key);
    const lastTs = lastTsStr ? parseInt(lastTsStr, 10) : 0;
    const now = Date.now();

    if (!lastTs || (now - lastTs) > limiteMs) {
      // incrementa el contador (hit)
      const hitResp = await fetch(`https://api.countapi.xyz/hit/${contadorID}/visitas`);
      if (!hitResp.ok) throw new Error("CountAPI hit fall√≥");
      const hitJson = await hitResp.json();
      document.getElementById("contador").innerText = `üëÅÔ∏è Visitas totales: ${hitJson.value}`;
      // guarda timestamp para esta IP
      localStorage.setItem(key, String(now));
    } else {
      // no incrementa: solo leer el valor actual
      const getResp = await fetch(`https://api.countapi.xyz/get/${contadorID}/visitas`);
      if (!getResp.ok) throw new Error("CountAPI get fall√≥");
      const getJson = await getResp.json();
      document.getElementById("contador").innerText = `üëÅÔ∏è Visitas totales: ${getJson.value}`;
    }
  } catch (err) {
    // Mensaje m√°s descriptivo para depuraci√≥n (pero amigable)
    console.warn("Contador global error:", err);
    document.getElementById("contador").innerText = "Error al contar visitas";
  }
}

contarVisitaConIP();
</script>
</body>
</html>
